/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds
 */
plugins {
   id 'base'
}
version '1.0.0-SNAPSHOT'

ext.repos = [
        'LocalMaven'   : "file://${projectDir}/../maven",
        'RemoteMavenRelease'   : "http://localhost:8081/artifactory/libs-release",
        'RemoteMavenSnapshot'   : "http://localhost:8081/artifactory/libs-snapshot"
]

ext.dependenciesVersion = [
        'demo004lib'   : "1.0.0-SNAPSHOT"
]

subprojects {
    afterEvaluate { project ->
    


        plugins.withType(JavaPlugin) {
            repositories {
                maven {
                    name = 'LocalMaven'
                    url = uri(repos.LocalMaven)
                }
                maven {
                    name = 'RemoteMaven'
                    if (project.version.endsWith('-SNAPSHOT')) {
                        url = uri(repos.RemoteMavenSnapshot)
                    } else {
                        url = uri(repos.RemoteMavenRelease)
                    }
                    credentials {
                        username 'admin'
                        password '!Passw0rd'
                    }
                }
                mavenCentral()
            }
        }
        plugins.withType(MavenPublishPlugin) {
        
        task publishDir(dependsOn:'publishMavenJavaPublicationToLocalMavenRepository'){}

task publishRemote(dependsOn:'publishMavenJavaPublicationToRemoteMavenRepository'){}

task publishAll(){
	dependsOn 'publishDir'
	dependsOn 'publishRemote'
}
        
            publishing {
                publications {
                    mavenJava(MavenPublication) {
                        from project.components.java
                    }
                }
                repositories {
                    maven {
                        name = 'LocalMaven'
                        url = uri(repos.LocalMaven)
                    }
                    maven {
                        name = 'RemoteMaven'
                        if (project.version.endsWith('-SNAPSHOT')) {
                            url = uri(repos.RemoteMavenSnapshot)
                        } else {
                            url = uri(repos.RemoteMavenRelease)
                        }
                        credentials {
                            username 'admin'
                            password '!Passw0rd'
                        }
                    }
                }
            }
        }
        
    }
}